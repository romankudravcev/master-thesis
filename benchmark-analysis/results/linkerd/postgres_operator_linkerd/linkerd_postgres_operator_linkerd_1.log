2025-08-20 14:57:34 [INFO] Starting migration process...
2025-08-20 14:57:34 [INFO] You will be prompted to select a networking tool and rerouting option to establish a secure connection and manage traffic between the clusters.
2025-08-20 14:58:53 [INFO] Initializing kubernetes clients
2025-08-20 14:58:53 [INFO] Checking connectivity between clusters
2025-08-20 14:58:53 [DEBUG] Fetching cluster IPs
2025-08-20 14:58:53 [DEBUG] Cleaning up probe resources
2025-08-20 14:58:53 [DEBUG] Testing connectivity with Origin IP: 192.168.100.1, Target IP: 192.168.131.3
2025-08-20 14:58:53 [DEBUG] Deploying probe resources
2025-08-20 14:58:54 [DEBUG] Waiting for pods to be ready
2025-08-20 14:58:59 [DEBUG] Pods are ready
2025-08-20 14:58:59 [DEBUG] Checking connectivity between clusters
2025-08-20 14:59:09 [DEBUG] Connectivity check successful with Origin IP: 192.168.100.1, Target IP: 192.168.131.3 - both clusters can reach each other
2025-08-20 14:59:09 [DEBUG] Cleaning up probe resources
2025-08-20 14:59:10 [DEBUG] Connectivity probe complete
2025-08-20 14:59:10 [INFO] Establishing secure connection between clusters
2025-08-20 14:59:10 [DEBUG] Create Linkerd certificates
2025-08-20 14:59:10 [INFO] Installing Linkerd
2025-08-20 14:59:10 [DEBUG] Install linkerd-crds
2025-08-20 14:59:19 [DEBUG] Install Linkerd control plane
2025-08-20 14:59:54 [DEBUG] Install linkerd-multicluster
2025-08-20 15:00:24 [INFO] Installing Linkerd
2025-08-20 15:00:24 [DEBUG] Install linkerd-crds
2025-08-20 15:00:34 [DEBUG] Install Linkerd control plane
2025-08-20 15:02:04 [DEBUG] Install linkerd-multicluster
2025-08-20 15:03:05 [INFO] Try fetching gateway service linkerd-gateway in namespace linkerd-multicluster
2025-08-20 15:03:06 [INFO] Try fetching gateway service linkerd-gateway in namespace linkerd-multicluster
2025-08-20 15:03:08 [INFO] Migrating configuration resources
2025-08-20 15:03:12 [INFO] Including namespace for Skupper: benchmar
2025-08-20 15:03:13 [INFO] Including namespace for Skupper: benchmark
2025-08-20 15:03:13 [INFO] Including namespace for Skupper: clustershift
2025-08-20 15:03:13 [INFO] Including namespace for Skupper: cnpg-system
2025-08-20 15:03:13 [INFO] Including namespace for Skupper: default
2025-08-20 15:03:13 [INFO] Skipping system namespace: kube-node-lease
2025-08-20 15:03:13 [INFO] Skipping system namespace: kube-public
2025-08-20 15:03:13 [INFO] Skipping system namespace: kube-system
2025-08-20 15:03:13 [INFO] Skipping system namespace: linkerd
2025-08-20 15:03:13 [INFO] Skipping system namespace: linkerd-multicluster
2025-08-20 15:03:13 [INFO] Skipping system namespace: metallb-system
2025-08-20 15:03:13 [INFO] Including namespace for Skupper: postgres
2025-08-20 15:03:13 [INFO] Skipping system namespace: traefik
2025-08-20 15:03:13 [INFO] Number of valid namespaces found: 6
2025-08-20 15:03:13 [INFO] No CNPG clusters found or error fetching them: the server could not find the requested resource
2025-08-20 15:03:13 [INFO] Waiting for deployments to be ready in namespace benchmar
2025-08-20 15:03:13 [INFO] Waiting for statefulsets to be ready in namespace benchmar
2025-08-20 15:03:13 [INFO] No CNPG clusters found or error fetching them: the server could not find the requested resource
2025-08-20 15:03:13 [INFO] Waiting for deployments to be ready in namespace benchmark
2025-08-20 15:03:13 [INFO] Waiting for statefulsets to be ready in namespace benchmark
2025-08-20 15:03:13 [INFO] Restarting deployment metrics-collector in namespace clustershift
2025-08-20 15:03:13 [INFO] No CNPG clusters found or error fetching them: the server could not find the requested resource
2025-08-20 15:03:13 [INFO] Waiting for deployments to be ready in namespace clustershift
2025-08-20 15:03:19 [INFO] Deployment metrics-collector is ready
2025-08-20 15:03:19 [INFO] Waiting for statefulsets to be ready in namespace clustershift
2025-08-20 15:03:19 [INFO] No CNPG clusters found or error fetching them: the server could not find the requested resource
2025-08-20 15:03:19 [INFO] Waiting for deployments to be ready in namespace cnpg-system
2025-08-20 15:03:19 [INFO] Waiting for statefulsets to be ready in namespace cnpg-system
2025-08-20 15:03:19 [INFO] No CNPG clusters found or error fetching them: the server could not find the requested resource
2025-08-20 15:03:19 [INFO] Waiting for deployments to be ready in namespace default
2025-08-20 15:03:19 [INFO] Waiting for statefulsets to be ready in namespace default
2025-08-20 15:03:19 [INFO] No CNPG clusters found or error fetching them: the server could not find the requested resource
2025-08-20 15:03:19 [INFO] Waiting for deployments to be ready in namespace postgres
2025-08-20 15:03:19 [INFO] Waiting for statefulsets to be ready in namespace postgres
2025-08-20 15:03:19 [INFO] Scanning for existing cnpg databases
2025-08-20 15:03:20 [INFO] Migrate cnpg databases
2025-08-20 15:03:20 [INFO] Installing cloud native-pg operator
2025-08-20 15:03:43 [INFO] Adding submariner clusterset DNS
2025-08-20 15:03:43 [INFO] fetching cnpg clusters
2025-08-20 15:03:43 [INFO] Updating cluster resources
2025-08-20 15:03:44 [INFO] Exporting cnpg rw services
2025-08-20 15:03:44 [INFO] fetching cnpg clusters
2025-08-20 15:03:44 [INFO] Exporting service my-postgres-cluster-rw in namespace postgres
2025-08-20 15:03:44 [INFO] Adding linkerd.io/inject=enabled annotation to namespace postgres
2025-08-20 15:03:44 [INFO] Rerolling all pods in namespace postgres
2025-08-20 15:03:44 [INFO] Restarting CNPG cluster my-postgres-cluster in namespace postgres
2025-08-20 15:03:44 [INFO] Waiting for CNPG clusters to be ready in namespace postgres
2025-08-20 15:03:44 [INFO] CNPG cluster my-postgres-cluster is ready
2025-08-20 15:03:44 [INFO] Waiting for deployments to be ready in namespace postgres
2025-08-20 15:03:44 [INFO] Waiting for statefulsets to be ready in namespace postgres
2025-08-20 15:03:45 [INFO] Creating replica cluster
2025-08-20 15:03:45 [INFO] Fetching origin cnpg clusters
2025-08-20 15:03:45 [INFO] Fetched origin clusters
2025-08-20 15:03:45 [INFO] Creating replica cluster from origin
2025-08-20 15:03:45 [DEBUG] &{{Cluster postgresql.cnpg.io/v1} {my-postgres-cluster  postgres    0 0001-01-01 00:00:00 +0000 UTC <nil> <nil> map[] map[] [] [] []} { <nil> ghcr.io/cloudnative-pg/postgresql:17.5 <nil>   26 26 3 0 0 {map[archive_mode:on archive_timeout:5min dynamic_shared_memory_type:posix full_page_writes:on log_destination:csvlog log_directory:/controller/log log_filename:postgres log_rotation_age:0 log_rotation_size:0 log_truncate_on_rotation:false logging_collector:on max_parallel_workers:32 max_replication_slots:32 max_worker_processes:32 shared_memory_type:mmap shared_preload_libraries: ssl_max_protocol_version:TLSv1.3 ssl_min_protocol_version:TLSv1.3 wal_keep_size:512MB wal_level:logical wal_log_hints:on wal_receiver_timeout:5s wal_sender_timeout:5s] <nil> [] [] {[] false} [] <nil> 0 false} 0x1400229b578 0x1400229b5d8 0x14000bb4c30 <nil> 0x1400268e102 0x140022b7f20 [] {0x14000064380 2Gi 0x1400268e103 nil} <nil> <nil> nil 3600 1800 0x1400268e104 3600 0 <nil> {<nil>  map[] nil [] preferred nil nil} [] {map[] map[] []} <nil>  unsupervised restart <nil> <nil> 0x14001c71600 [{my-postgres-cluster map[dbname:postgres host:my-postgres-cluster-rw-origin.postgres.svc.cluster.local sslmode:verify-full user:streaming_replica] &SecretKeySelector{LocalObjectReference:LocalObjectReference{Name:my-postgres-cluster-replication,},Key:tls.crt,Optional:nil,} &SecretKeySelector{LocalObjectReference:LocalObjectReference{Name:my-postgres-cluster-replication,},Key:tls.key,Optional:nil,} &SecretKeySelector{LocalObjectReference:LocalObjectReference{Name:my-postgres-cluster-ca,},Key:ca.crt,Optional:nil,} nil <nil> <nil>}] info nil [] [] <nil> nil [] 0x1400268e109 [] <nil>} {0 0 map[] map[] {map[] map[] map[]} [] 0 {map[] 0 false} 0    0 0 [] [] [] [] []     {   map[]      map[] map[]} {map[]} {{    []} map[]}  map[]  map[]      <nil>  [] [] [] false false  [] {false} }}
2025-08-20 15:06:16 [INFO] Created replica clusters
2025-08-20 15:06:16 [INFO] Migrating MongoDBs
2025-08-20 15:06:16 [INFO] No existing MongoDBs found, skipping migration
2025-08-20 15:06:16 [INFO] Checking for existing MongoDB Community Operator deployment
2025-08-20 15:06:16 [DEBUG] No MongoDB Community Operator found in origin cluster, skipping operator migration
2025-08-20 15:06:16 [INFO] Migrating PostgreSQL databases
2025-08-20 15:06:16 [INFO] No existing PostgreSQL databases found, skipping migration
2025-08-20 15:06:16 [INFO] Migrating resources
2025-08-20 15:06:18 [INFO] Demote cnpg clusters
2025-08-20 15:06:18 [INFO] fetching cnpg clusters
2025-08-20 15:06:18 [INFO] Fetched clusters
2025-08-20 15:06:18 [INFO] Successfully updated cluster my-postgres-cluster in namespace postgres
2025-08-20 15:06:18 [INFO] Completed demoting clusters
2025-08-20 15:06:18 [INFO] Demote cnpg clusters
2025-08-20 15:06:18 [INFO] fetching cnpg clusters
2025-08-20 15:06:18 [INFO] Fetched clusters
2025-08-20 15:06:18 [INFO] Successfully updated cluster my-postgres-cluster in namespace postgres
2025-08-20 15:06:18 [INFO] Completed demoting clusters
2025-08-20 15:06:18 [INFO] Enable request forwarding from origin
2025-08-20 15:06:19 [INFO] Mirroring service clustershift-benchmark-service in namespace benchmark
2025-08-20 15:06:19 [INFO] Mirroring service metrics-collector in namespace clustershift
2025-08-20 15:06:19 [INFO] Mirroring service cnpg-webhook-service in namespace cnpg-system
2025-08-20 15:06:19 [INFO] Mirroring service kubernetes in namespace default
2025-08-20 15:06:19 [INFO] Mirroring service kube-dns in namespace kube-system
2025-08-20 15:06:19 [INFO] Mirroring service metrics-server in namespace kube-system
2025-08-20 15:06:19 [INFO] Mirroring service linkerd-gateway in namespace linkerd-multicluster
2025-08-20 15:06:19 [INFO] Mirroring service probe-gateway-origin in namespace linkerd-multicluster
2025-08-20 15:06:19 [INFO] Mirroring service probe-gateway-target in namespace linkerd-multicluster
2025-08-20 15:06:19 [INFO] Mirroring service linkerd-dst in namespace linkerd
2025-08-20 15:06:19 [INFO] Mirroring service linkerd-dst-headless in namespace linkerd
2025-08-20 15:06:20 [INFO] Mirroring service linkerd-identity in namespace linkerd
2025-08-20 15:06:20 [INFO] Mirroring service linkerd-identity-headless in namespace linkerd
2025-08-20 15:06:20 [INFO] Mirroring service linkerd-policy in namespace linkerd
2025-08-20 15:06:20 [INFO] Mirroring service linkerd-policy-validator in namespace linkerd
2025-08-20 15:06:20 [INFO] Mirroring service linkerd-proxy-injector in namespace linkerd
2025-08-20 15:06:20 [INFO] Mirroring service linkerd-sp-validator in namespace linkerd
2025-08-20 15:06:20 [INFO] Mirroring service metallb-webhook-service in namespace metallb-system
2025-08-20 15:06:20 [INFO] Mirroring service my-postgres-cluster-r in namespace postgres
2025-08-20 15:06:21 [INFO] Mirroring service my-postgres-cluster-ro in namespace postgres
2025-08-20 15:06:21 [INFO] Mirroring service my-postgres-cluster-rw in namespace postgres
2025-08-20 15:06:21 [INFO] Mirroring service my-postgres-cluster-rw-origin in namespace postgres
2025-08-20 15:06:21 [INFO] Mirroring service my-postgres-cluster-rw-target in namespace postgres
2025-08-20 15:06:21 [INFO] Mirroring service traefik in namespace traefik
2025-08-20 15:06:22 [INFO] Restarting deployment traefik in namespace traefik
2025-08-20 15:06:22 [INFO] Waiting for CNPG clusters to be ready in namespace traefik
2025-08-20 15:06:22 [INFO] Waiting for deployments to be ready in namespace traefik
2025-08-20 15:06:27 [INFO] Deployment traefik is ready
2025-08-20 15:06:27 [INFO] Waiting for statefulsets to be ready in namespace traefik
2025-08-20 15:06:27 [INFO] Updating service name in IngressRoute clustershift-benchmark-ingress-route from clustershift-benchmark-service to clustershift-benchmark-service-target
2025-08-20 15:06:27 [INFO] Updating service name in IngressRoute metrics-collector-route from metrics-collector to metrics-collector-target
2025-08-20 15:06:28 [DEBUG] Ignoring IngressRoute traefik-dashboard as it is the Traefik dashboard
2025-08-20 15:06:28 [INFO] Migration complete
